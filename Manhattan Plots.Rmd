---
title: "Manhattan Plots: TCGA and Abida"
output: html_document
---
### Load datasets add fusion info to TCGA
Load mae objects, take complete cases
```{r, message = FALSE}
library(curatedPCaData)
TCGA <- curatedPCaData::mae_tcga
TCGA <- intersectColumns(TCGA)
Abida <- curatedPCaData::mae_abida
Abida <- intersectColumns(Abida)
```
### Subset TCGA and Abida datasets by ETS-family fusion status
Subset CNA profiles by fusion status
``` {r}
#TCGA subset
TCGA.fusion.neg <- TCGA[,TCGA$ERG_fusion_GEX==0]
TCGA.fusion.pos <- TCGA[,TCGA$ERG_fusion_GEX==1]
#Abida subset
Abida.fusion.neg <- Abida[,Abida$ERG_fusion_GEX==0]
Abida.fusion.pos <- Abida[,Abida$ERG_fusion_GEX==1]
```
Format CNA profiles for enrichment analysis
```{r}
#Format TCGA
TCGA.fusion.pos <- cbind(rownames(TCGA.fusion.pos@ExperimentList@listData$cna.gistic),
                         TCGA.fusion.pos@ExperimentList@listData$cna.gistic)
colnames(TCGA.fusion.pos)[1] <- "Hugo_Symbol"
TCGA.fusion.neg <- cbind(rownames(TCGA.fusion.neg@ExperimentList@listData$cna.gistic),
                         TCGA.fusion.neg@ExperimentList@listData$cna.gistic)
colnames(TCGA.fusion.neg)[1] <- "Hugo_Symbol"
#Format Abida
Abida.fusion.pos <- cbind(rownames(Abida.fusion.pos@ExperimentList@listData$cna.gistic),
                         Abida.fusion.pos@ExperimentList@listData$cna.gistic)
colnames(Abida.fusion.pos)[1] <- "Hugo_Symbol"
Abida.fusion.neg <- cbind(rownames(Abida.fusion.neg@ExperimentList@listData$cna.gistic),
                         Abida.fusion.neg@ExperimentList@listData$cna.gistic)
colnames(Abida.fusion.neg)[1] <- "Hugo_Symbol"
```
Compute CNA enrichment in context of ETS fusions (Curated PCa)
```{r, message=FALSE}
source("analysis scripts.R")
TCGA.loss.enrichment <- concurrent.loss.data(TCGA.fusion.neg, TCGA.fusion.pos)
Abida.loss.enrichment <-concurrent.loss.data(Abida.fusion.neg, Abida.fusion.pos)
```
### Manhattan Plots for TCGA
Generate manhattan plot objects (GR object) for TCGA patients
```{r, message=FALSE}
source("manhattan.R")
#----------GR object for pval plot----------
#ERG+ Patients
TCGA.loss.fusion.pos <- data.frame(TCGA.loss.enrichment$Hugo_Symbol[TCGA.loss.enrichment$`normalized subtype loss ratio` < 1],
                               TCGA.loss.enrichment$`loss p val`[TCGA.loss.enrichment$`normalized subtype loss ratio` < 1])
TCGA.loss.fusion.pos <- na.omit(TCGA.loss.fusion.pos)
TCGA.loss.fusion.pos.gr.pval <- manhattan.object(TCGA.loss.fusion.pos)
#ERG- Patients
TCGA.loss.fusion.neg <- data.frame(TCGA.loss.enrichment$Hugo_Symbol[TCGA.loss.enrichment$`normalized subtype loss ratio` > 1],
                               TCGA.loss.enrichment$`loss p val`[TCGA.loss.enrichment$`normalized subtype loss ratio` > 1])
TCGA.loss.fusion.neg <- na.omit(TCGA.loss.fusion.neg)
TCGA.loss.fusion.neg.gr.pval <- manhattan.object(TCGA.loss.fusion.neg)
#----------GR object for OR plot----------
#ERG+ patients
TCGA.loss.fusion.pos <- data.frame(TCGA.loss.enrichment$Hugo_Symbol[TCGA.loss.enrichment$`normalized subtype loss ratio` < 1],
                               (1/TCGA.loss.enrichment$`odds ratio`[TCGA.loss.enrichment$`normalized subtype loss ratio` < 1]))
TCGA.loss.fusion.pos.gr.OR <- manhattan.object(TCGA.loss.fusion.pos)
#ERG- patients
TCGA.loss.fusion.neg <- data.frame(TCGA.loss.enrichment$Hugo_Symbol[TCGA.loss.enrichment$`normalized subtype loss ratio` > 1],
                               TCGA.loss.enrichment$`odds ratio`[TCGA.loss.enrichment$`normalized subtype loss ratio` > 1])
TCGA.loss.fusion.neg.gr.OR <- manhattan.object(TCGA.loss.fusion.neg)
#----------GR object for normalized loss frequency plot----------
#ERG+ patients
TCGA.loss.fusion.pos <- data.frame(TCGA.loss.enrichment$Hugo_Symbol[TCGA.loss.enrichment$`normalized subtype loss ratio` < 1],
                               (1/TCGA.loss.enrichment$`normalized subtype loss ratio`[TCGA.loss.enrichment$`normalized subtype loss ratio` < 1]))
TCGA.loss.fusion.pos.gr.freq <- manhattan.object(TCGA.loss.fusion.pos)
#ERG- patients
TCGA.loss.fusion.neg <- data.frame(TCGA.loss.enrichment$Hugo_Symbol[TCGA.loss.enrichment$`normalized subtype loss ratio` > 1],
                               TCGA.loss.enrichment$`normalized subtype loss ratio`[TCGA.loss.enrichment$`normalized subtype loss ratio` > 1])
TCGA.loss.fusion.neg.gr.freq <- manhattan.object(TCGA.loss.fusion.neg)
```
Generate manhattan plots for loss frequency, and enrichment odds ratio / pval in TCGA
```{r}
pdf("TCGA manhattan plots.pdf")
#----------pval plot----------
params <- getDefaultPlotParams(plot.type = 4)
params$leftmargin = 0.15
params$topmargin = 20
params$bottommargin = 30
kp <- plotKaryotype(plot.type=4, cex = 0.85, labels.plotter = NULL, plot.params = params)
kpAddChromosomeNames(kp, srt = 90, cex = 0.78, yoffset = 0)
#Add ERG+ p-val manhattan plot
kp <- kpPlotManhattan(kp, TCGA.loss.fusion.pos.gr.pval, r0=0.5, r1=1, ymax=15, points.col = "dark orange", points.cex = 0.4, suggestive.col = "white", genomewide.col = "white")
kpAxis(kp, ymin=1, ymax=15, r0=0.5, r1=1, tick.pos = c(1,5,10,15))
kpAddLabels(kp, labels = "ERG+ Patients\n-log10(p-val)", srt=90, pos=1, r0=0.5, r1=1, cex=1, label.margin = 0.13)
#Add ERG- p-val manhattan plot
kp <- kpPlotManhattan(kp, TCGA.loss.fusion.neg.gr.pval, r0=0.5, r1=0, ymax=15, points.col = "navy", points.cex = 0.4, suggestive.col = "white", genomewide.col = "white")
kpAxis(kp, ymin=1, ymax=15, r0=0.5, r1=0, tick.pos = c(1,5,10,15))
kpAddLabels(kp, labels = "ERG- Patients\n-log10(p-val)", srt=90, pos=1, r0=0.5, r1=0, cex=1, label.margin = 0.13)
kpAddMainTitle(kp, main = "Copy Number Loss Enrichment: TCGA")
#----------OR plot----------
params <- getDefaultPlotParams(plot.type = 4)
params$leftmargin = 0.15
params$topmargin = 20
params$bottommargin = 30
kp <- plotKaryotype(plot.type=4, cex = 0.85, labels.plotter = NULL, plot.params = params)
kpAddChromosomeNames(kp, srt = 90, cex = 0.78, yoffset = 0)
#Add ERG+ OR manhattan plot
kp <- kpPlotManhattan(kp, TCGA.loss.fusion.pos.gr.OR, r0=0.5, r1=1, ymax=20, points.col = "dark orange", points.cex = 0.4, genomewide.col = "white", suggestive.col = "white", logp = FALSE, ymin = 1)
kpAxis(kp, ymin=1, ymax=20, r0=0.5, r1=1, tick.pos = c(1,5,10,15,20))
kpAddLabels(kp, labels = "ERG+ Patients\n(Odds Ratio)", srt=90, pos=1, r0=0.5, r1=1, cex=1, label.margin = 0.13)
#Add ERG- OR manhattan plot
kp <- kpPlotManhattan(kp, TCGA.loss.fusion.neg.gr.OR, r0=0.5, r1=0, ymax=20, points.col = "navy", points.cex = 0.4, genomewide.col = "white", suggestive.col = "white", logp = FALSE, ymin = 1)
kpAxis(kp, ymin=1, ymax=20, r0=0.5, r1=0, tick.pos = c(5,10,15,20))
kpAddLabels(kp, labels = "ERG- Patients\n(Odds Ratio)", srt=90, pos=1, r0=0.5, r1=0, cex=1, label.margin = 0.13)
kpAddMainTitle(kp, main = "Copy Number Loss Enrichment: TCGA")
#----------Frequency Plot-----------
params <- getDefaultPlotParams(plot.type = 4)
params$leftmargin = 0.15
params$topmargin = 20
params$bottommargin = 30
kp <- plotKaryotype(plot.type=4, cex = 0.85, labels.plotter = NULL, plot.params = params)
kpAddChromosomeNames(kp, srt = 90, cex = 0.78, yoffset = 0)
#Add ERG+ frequency manhattan plot
kp <- kpPlotManhattan(kp, TCGA.loss.fusion.pos.gr.freq, r0=0.5, r1=1, ymax=25, points.col = "dark orange", points.cex = 0.4, genomewide.col = "white", suggestive.col = "white", logp = FALSE, ymin = 1)
kpAxis(kp, ymin=1, ymax=25, r0=0.5, r1=1, tick.pos = c(1,5,10,15,20,25))
kpAddLabels(kp, labels = "ERG+ Patients", srt=90, pos=1, r0=0.5, r1=1, cex=1, label.margin = 0.13)
#Add ERG- frequency manhattan plot
kp <- kpPlotManhattan(kp, TCGA.loss.fusion.neg.gr.freq, r0=0.5, r1=0, ymax=25, points.col = "navy", points.cex = 0.4, genomewide.col = "white", suggestive.col = "white", logp = FALSE, ymin = 1)
kpAxis(kp, ymin=1, ymax=25, r0=0.5, r1=0, tick.pos = c(5,10,15,20,25))
kpAddLabels(kp, labels = "ERG- Patients", srt=90, pos=1, r0=0.5, r1=0, cex=1, label.margin = 0.13)
kpAddMainTitle(kp, main = "Copy Number Loss Frequency: TCGA")
dev.off()
```
``` {r}
```
### Manhattan Plots for Abida
Generate manhattan plot objects (GR object) for Abida patients
```{r, message=FALSE}
source("manhattan.R")
#----------GR object for pval plot----------
#ERG+ Patients
Abida.loss.fusion.pos <- data.frame(Abida.loss.enrichment$Hugo_Symbol[Abida.loss.enrichment$`normalized subtype loss ratio` < 1],
                               Abida.loss.enrichment$`loss p val`[Abida.loss.enrichment$`normalized subtype loss ratio` < 1])
Abida.loss.fusion.pos <- na.omit(Abida.loss.fusion.pos)
Abida.loss.fusion.pos.gr.pval <- manhattan.object(Abida.loss.fusion.pos)
#ERG- Patients
Abida.loss.fusion.neg <- data.frame(Abida.loss.enrichment$Hugo_Symbol[Abida.loss.enrichment$`normalized subtype loss ratio` > 1],
                               Abida.loss.enrichment$`loss p val`[Abida.loss.enrichment$`normalized subtype loss ratio` > 1])
Abida.loss.fusion.neg <- na.omit(Abida.loss.fusion.neg)
Abida.loss.fusion.neg.gr.pval <- manhattan.object(Abida.loss.fusion.neg)
#----------GR object for OR plot----------
#ERG+ patients
Abida.loss.fusion.pos <- data.frame(Abida.loss.enrichment$Hugo_Symbol[Abida.loss.enrichment$`normalized subtype loss ratio` < 1],
                               (1/Abida.loss.enrichment$`odds ratio`[Abida.loss.enrichment$`normalized subtype loss ratio` < 1]))
Abida.loss.fusion.pos.gr.OR <- manhattan.object(Abida.loss.fusion.pos)
#ERG- patients
Abida.loss.fusion.neg <- data.frame(Abida.loss.enrichment$Hugo_Symbol[Abida.loss.enrichment$`normalized subtype loss ratio` > 1],
                               Abida.loss.enrichment$`odds ratio`[Abida.loss.enrichment$`normalized subtype loss ratio` > 1])
Abida.loss.fusion.neg.gr.OR <- manhattan.object(Abida.loss.fusion.neg)
#----------GR object for normalized loss frequency plot----------
#ERG+ patients
Abida.loss.fusion.pos <- data.frame(Abida.loss.enrichment$Hugo_Symbol[Abida.loss.enrichment$`normalized subtype loss ratio` < 1],
                               (1/Abida.loss.enrichment$`normalized subtype loss ratio`[Abida.loss.enrichment$`normalized subtype loss ratio` < 1]))
Abida.loss.fusion.pos.gr.freq <- manhattan.object(Abida.loss.fusion.pos)
#ERG- patients
Abida.loss.fusion.neg <- data.frame(Abida.loss.enrichment$Hugo_Symbol[Abida.loss.enrichment$`normalized subtype loss ratio` > 1],
                               Abida.loss.enrichment$`normalized subtype loss ratio`[Abida.loss.enrichment$`normalized subtype loss ratio` > 1])
Abida.loss.fusion.neg.gr.freq <- manhattan.object(Abida.loss.fusion.neg)
```
Generate manhattan plots for loss frequency, and enrichment odds ratio / pval in Abida
```{r}
pdf("Abida manhattan plots.pdf")
#----------pval plot----------
params <- getDefaultPlotParams(plot.type = 4)
params$leftmargin = 0.15
params$topmargin = 20
params$bottommargin = 30
kp <- plotKaryotype(plot.type=4, cex = 0.85, labels.plotter = NULL, plot.params = params)
kpAddChromosomeNames(kp, srt = 90, cex = 0.78, yoffset = 0)
#Add ERG+ p-val manhattan plot
kp <- kpPlotManhattan(kp, Abida.loss.fusion.pos.gr.pval, r0=0.5, r1=1, ymax=15, points.col = "dark orange", points.cex = 0.4, suggestive.col = "white", genomewide.col = "white")
kpAxis(kp, ymin=1, ymax=15, r0=0.5, r1=1, tick.pos = c(1,5,10,15))
kpAddLabels(kp, labels = "ERG+ Patients\n-log10(p-val)", srt=90, pos=1, r0=0.5, r1=1, cex=1, label.margin = 0.13)
#Add ERG- p-val manhattan plot
kp <- kpPlotManhattan(kp, Abida.loss.fusion.neg.gr.pval, r0=0.5, r1=0, ymax=15, points.col = "navy", points.cex = 0.4, suggestive.col = "white", genomewide.col = "white")
kpAxis(kp, ymin=1, ymax=15, r0=0.5, r1=0, tick.pos = c(1,5,10,15))
kpAddLabels(kp, labels = "ERG- Patients\n-log10(p-val)", srt=90, pos=1, r0=0.5, r1=0, cex=1, label.margin = 0.13)
kpAddMainTitle(kp, main = "Copy Number Loss Enrichment: Abida")
#----------OR plot----------
params <- getDefaultPlotParams(plot.type = 4)
params$leftmargin = 0.15
params$topmargin = 20
params$bottommargin = 30
kp <- plotKaryotype(plot.type=4, cex = 0.85, labels.plotter = NULL, plot.params = params)
kpAddChromosomeNames(kp, srt = 90, cex = 0.78, yoffset = 0)
#Add ERG+ OR manhattan plot
kp <- kpPlotManhattan(kp, Abida.loss.fusion.pos.gr.OR, r0=0.5, r1=1, ymax=20, points.col = "dark orange", points.cex = 0.4, genomewide.col = "white", suggestive.col = "white", logp = FALSE, ymin = 1)
kpAxis(kp, ymin=1, ymax=20, r0=0.5, r1=1, tick.pos = c(1,5,10,15,20))
kpAddLabels(kp, labels = "ERG+ Patients\n(Odds Ratio)", srt=90, pos=1, r0=0.5, r1=1, cex=1, label.margin = 0.13)
#Add ERG- OR manhattan plot
kp <- kpPlotManhattan(kp, Abida.loss.fusion.neg.gr.OR, r0=0.5, r1=0, ymax=20, points.col = "navy", points.cex = 0.4, genomewide.col = "white", suggestive.col = "white", logp = FALSE, ymin = 1)
kpAxis(kp, ymin=1, ymax=20, r0=0.5, r1=0, tick.pos = c(5,10,15,20))
kpAddLabels(kp, labels = "ERG- Patients\n(Odds Ratio)", srt=90, pos=1, r0=0.5, r1=0, cex=1, label.margin = 0.13)
kpAddMainTitle(kp, main = "Copy Number Loss Enrichment: Abida")
#----------Frequency Plot-----------
params <- getDefaultPlotParams(plot.type = 4)
params$leftmargin = 0.15
params$topmargin = 20
params$bottommargin = 30
kp <- plotKaryotype(plot.type=4, cex = 0.85, labels.plotter = NULL, plot.params = params)
kpAddChromosomeNames(kp, srt = 90, cex = 0.78, yoffset = 0)
#Add ERG+ frequency manhattan plot
kp <- kpPlotManhattan(kp, Abida.loss.fusion.pos.gr.freq, r0=0.5, r1=1, ymax=25, points.col = "dark orange", points.cex = 0.4, genomewide.col = "white", suggestive.col = "white", logp = FALSE, ymin = 1)
kpAxis(kp, ymin=1, ymax=25, r0=0.5, r1=1, tick.pos = c(1,5,10,15,20,25))
kpAddLabels(kp, labels = "ERG+ Patients", srt=90, pos=1, r0=0.5, r1=1, cex=1, label.margin = 0.13)
#Add ERG- frequency manhattan plot
kp <- kpPlotManhattan(kp, Abida.loss.fusion.neg.gr.freq, r0=0.5, r1=0, ymax=25, points.col = "navy", points.cex = 0.4, genomewide.col = "white", suggestive.col = "white", logp = FALSE, ymin = 1)
kpAxis(kp, ymin=1, ymax=25, r0=0.5, r1=0, tick.pos = c(5,10,15,20,25))
kpAddLabels(kp, labels = "ERG- Patients", srt=90, pos=1, r0=0.5, r1=0, cex=1, label.margin = 0.13)
kpAddMainTitle(kp, main = "Copy Number Loss Frequency: Abida")
dev.off()
```